Description: Fix FTBFS with FFmpeg 4.0
Author: Steve Peters <scpeters@openrobotics.org>
Origin: upstream, https://bitbucket.org/osrf/gazebo/commits/0c6e09de8c20d8465b59a364dbb887c462f72afa
Bug-Debian: https://bugs.debian.org/888365
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/gazebo/common/AudioDecoder.cc
+++ b/gazebo/common/AudioDecoder.cc
@@ -255,8 +255,13 @@ bool AudioDecoder::SetFile(const std::st
     return false;
   }
 
+#if LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(56, 60, 100)
+  if (this->codec->capabilities & AV_CODEC_CAP_TRUNCATED)
+    this->codecCtx->flags |= AV_CODEC_FLAG_TRUNCATED;
+#else
   if (this->codec->capabilities & CODEC_CAP_TRUNCATED)
     this->codecCtx->flags |= CODEC_FLAG_TRUNCATED;
+#endif
 
   // Open codec
   if (avcodec_open2(this->codecCtx, this->codec, nullptr) < 0)
--- a/gazebo/common/Video.cc
+++ b/gazebo/common/Video.cc
@@ -143,8 +143,13 @@ bool Video::Load(const std::string &_fil
 
   // Inform the codec that we can handle truncated bitstreams -- i.e.,
   // bitstreams where frame boundaries can fall in the middle of packets
+#if LIBAVCODEC_VERSION_INT >= AV_VERSION_INT(56, 60, 100)
+  if (codec->capabilities & AV_CODEC_CAP_TRUNCATED)
+    this->codecCtx->flags |= AV_CODEC_FLAG_TRUNCATED;
+#else
   if (codec->capabilities & CODEC_CAP_TRUNCATED)
     this->codecCtx->flags |= CODEC_FLAG_TRUNCATED;
+#endif
 
   // Open codec
   if (avcodec_open2(this->codecCtx, codec, nullptr) < 0)
